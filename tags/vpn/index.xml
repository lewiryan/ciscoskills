<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>VPN on Cisco Skills</title>
    <link>https://ciscoskills.net/tags/vpn/</link>
    <description>Recent content in VPN on Cisco Skills</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Sun, 11 Oct 2020 18:13:30 +0000</lastBuildDate><atom:link href="https://ciscoskills.net/tags/vpn/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Fortigate ECMP with BGP</title>
      <link>https://ciscoskills.net/2020/10/11/fortigate-ecmp-with-bgp/</link>
      <pubDate>Sun, 11 Oct 2020 18:13:30 +0000</pubDate>
      
      <guid>https://ciscoskills.net/2020/10/11/fortigate-ecmp-with-bgp/</guid>
      <description>
        
          &lt;p&gt;It&#39;s like clock work...around this time the seasons are changing..autumn colors are out, and the colder air reminds us that things are changing around here, embrace it! One thing that I&#39;ve been working with is AWS Transit gateways, a common theme this year is all cloud! AWS Transit Gateways make it easier to move towards that!&lt;/p&gt;
&lt;!--adsense--&gt;
&lt;p&gt;AWS Transit gateways relatively new, (couple years old now) so instead of attaching to each AWS VPC environment independently we can connect to the transit gateway and attach VPCs to the gateway. If you enable BGP your routes will propagate. I&#39;ve been working with ECMP, specifically with Fortigates.&lt;/p&gt;
&lt;p&gt;There are two ways to have redundancy in a network when you have multiple paths to a destination. Similar routes that have a higher cost/weight then ones that don&#39;t are only used when there is a problem with primary path. So you have a backup route on standby until the primary route fails. This could be a good option if the backup route isn&#39;t the same bandwidth/media or really not equal to the primary link which is why different cost/weight is important to have.&lt;/p&gt;
&lt;p&gt;However if you have multiple paths that were equal bandwidth/media we could/would want to use both of them at the same time so that traffic is load balanced across the network, this is called ECMP (Equal-cost multi-path routing)&lt;/p&gt;
&lt;p&gt;Let&#39;s walk though the steps on how to setup ECMP on a Fortigate using BGP. I&#39;m already guessing you have an AWS account with an AWS transit gateway deployed that supports ECMP, as well as configured your customer gateway in AWS with BGP Autonomous system (AS) number.&lt;/p&gt;
&lt;p&gt;In this example I have a Fortigate Firewall running version 6.4.2, I have set the BGP &amp;quot;AS&amp;quot; number to 65000 and the AWS &amp;quot;AS&amp;quot; number is 64512.&lt;/p&gt;
&lt;p&gt;Amazon gives you a text file to download the configuration for these two tunnels but depending on your Fortigate setup we may have to tweak the file, (not a good idea to just paste it) In this example here is what I have for tunnel one:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;# Configure Phase 1 of the tunnel, aka IKE  
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;config vpn ipsec phase1-interface  
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;edit &amp;#34;AWS-0615bcc6f-1&amp;#34;  
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;set dpd on-idle  
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;# Outside Interface to reach AWS  
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;set interface outside  
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;# External IP address using (RFC 5737) in this example
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;set local-gw 198.51.100.1  
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;set dhgrp 2  
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;set proposal aes128-sha1  
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;set keylife 28800  
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;# Remote Peer this is AWS Transit, using (RFC 5737) in example`  
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;set remote-gw 192.0.2.124  
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;set psksecret ciscoskills.net  
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;set dpd-retryinterval 10  
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;next  
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;end  
&lt;span class=&#34;ln&#34;&gt;21&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt;22&lt;/span&gt;# Configure Phase 2 of the Tunnel, aka IPSEC  
&lt;span class=&#34;ln&#34;&gt;23&lt;/span&gt;config vpn ipsec phase2-interface  
&lt;span class=&#34;ln&#34;&gt;24&lt;/span&gt;edit &amp;#34;AWS-0615bcc6f-1&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;25&lt;/span&gt;set phase1name &amp;#34;AWS-0615bcc6f-1&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;26&lt;/span&gt;set proposal aes128-sha1  
&lt;span class=&#34;ln&#34;&gt;27&lt;/span&gt;set dhgrp 2  
&lt;span class=&#34;ln&#34;&gt;28&lt;/span&gt;set pfs enable  
&lt;span class=&#34;ln&#34;&gt;29&lt;/span&gt;set keylifeseconds 3600  
&lt;span class=&#34;ln&#34;&gt;30&lt;/span&gt;end
&lt;span class=&#34;ln&#34;&gt;31&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;32&lt;/span&gt;# Build the tunnel interface  
&lt;span class=&#34;ln&#34;&gt;33&lt;/span&gt;config system interface   
&lt;span class=&#34;ln&#34;&gt;34&lt;/span&gt;edit &amp;#34;AWS-0615bcc6f-1&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;35&lt;/span&gt;set vdom &amp;#34;root&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;36&lt;/span&gt;set ip 169.254.150.142 255.255.255.255  
&lt;span class=&#34;ln&#34;&gt;37&lt;/span&gt;set allowaccess ping  
&lt;span class=&#34;ln&#34;&gt;38&lt;/span&gt;set type tunnel  
&lt;span class=&#34;ln&#34;&gt;39&lt;/span&gt;set tcp-mss 1379  
&lt;span class=&#34;ln&#34;&gt;40&lt;/span&gt;set remote-ip 169.254.150.141/32  
&lt;span class=&#34;ln&#34;&gt;41&lt;/span&gt;set mtu enable  
&lt;span class=&#34;ln&#34;&gt;42&lt;/span&gt;set mtu 1427  
&lt;span class=&#34;ln&#34;&gt;43&lt;/span&gt;set interface &amp;#34;outside&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;44&lt;/span&gt;next  
&lt;span class=&#34;ln&#34;&gt;45&lt;/span&gt;end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After the tunnel one is created, AWS gives us configuration for the second tunnel, basically the same configuration with some differences, here is tunnel two.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;# Configure Phase 1 of the tunnel, aka IKE  
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;config vpn ipsec phase1-interface  
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;edit &amp;#34;AWS-0615bcc6f-2&amp;#34;  
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;set dpd on-idle  
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;# Outside Interface to reach AWS  
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;set interface outside  
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;# External IP address using (RFC 5737) in this example  
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;set local-gw 198.51.100.1  
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;set dhgrp 2  
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;set proposal aes128-sha1  
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;set keylife 28800  
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;# Remote Peer this is AWS Transit, using (RFC 5737) in example  
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;set remote-gw 203.0.113.25  
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;set psksecret ciscoskills.com  
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;set dpd-retryinterval 10  
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;next  
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;end  
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;# Configure Phase 2 of the Tunnel, aka IPSEC  
&lt;span class=&#34;ln&#34;&gt;21&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt;22&lt;/span&gt;config vpn ipsec phase2-interface  
&lt;span class=&#34;ln&#34;&gt;23&lt;/span&gt;edit &amp;#34;AWS-0615bcc6f-2&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;24&lt;/span&gt;set phase1name &amp;#34;AWS-0615bcc6f-2&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;25&lt;/span&gt;set proposal aes128-sha1  
&lt;span class=&#34;ln&#34;&gt;26&lt;/span&gt;set dhgrp 2  
&lt;span class=&#34;ln&#34;&gt;27&lt;/span&gt;set pfs enable  
&lt;span class=&#34;ln&#34;&gt;28&lt;/span&gt;set keylifeseconds 3600  
&lt;span class=&#34;ln&#34;&gt;29&lt;/span&gt;end  
&lt;span class=&#34;ln&#34;&gt;30&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt;31&lt;/span&gt;# Build the tunnel interface  
&lt;span class=&#34;ln&#34;&gt;32&lt;/span&gt;config system interface  
&lt;span class=&#34;ln&#34;&gt;33&lt;/span&gt;edit &amp;#34;AWS-0615bcc6f-2&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;34&lt;/span&gt;set vdom &amp;#34;root&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;35&lt;/span&gt;set ip 169.254.157.90 255.255.255.255  
&lt;span class=&#34;ln&#34;&gt;36&lt;/span&gt;set allowaccess ping  
&lt;span class=&#34;ln&#34;&gt;37&lt;/span&gt;set type tunnel  
&lt;span class=&#34;ln&#34;&gt;38&lt;/span&gt;set tcp-mss 1379  
&lt;span class=&#34;ln&#34;&gt;39&lt;/span&gt;set remote-ip 169.254.157.89/32  
&lt;span class=&#34;ln&#34;&gt;40&lt;/span&gt;set mtu enable  
&lt;span class=&#34;ln&#34;&gt;41&lt;/span&gt;set mtu 1427  
&lt;span class=&#34;ln&#34;&gt;42&lt;/span&gt;set interface &amp;#34;outside&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;43&lt;/span&gt;next  
&lt;span class=&#34;ln&#34;&gt;44&lt;/span&gt;end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We now have two tunnels configured, these won&#39;t show online until the Fortigate has a policy attached to them. So you could put firewall rules on each tunnel interface or better yet is to create a zone within the Fortigate and add the two tunnel interfaces into same zone. By creating a zone within Fortigate the same firewall rules apply to each interface instead of creating/copying rules to each tunnel interface. (This would be an example)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;config system zone  
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;edit AWS-0615bcc6f  
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;set interface AWS-0615bcc6f-1  
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;set interface AWS-0615bcc6f-2  
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;set intrazone allow  
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt;next  
&lt;span class=&#34;ln&#34;&gt;7&lt;/span&gt;end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Once those interfaces are either in a zone and in a Firewall policy you should be able to bring those tunnel interfaces online. The final thing is configure our Fortigate with BGP so that when you attach a VPC to the transit gateway that IP space gets advertised automatically. We also want to enable ECMP with BGP.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;# Enable BGP on the Fortigate  
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;config router bgp  
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;# This is the number we set in AWS, so it should match what TG has  
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;set as 65000   
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;set router-id `198.51.100.1`  
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;# Since we are using &amp;#34;AS&amp;#34; Numbers, we tell the Fortigate to use    
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;# External Multipath with out it BGP will use one route at time  
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;# Active/Passive  
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;set ebgp-multipath enable  
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;config neighbor  
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;edit &amp;#34;169.254.157.89&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;set remote-as 64512  
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;next  
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;edit &amp;#34;169.254.150.141&amp;#34;  
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;set remote-as 64512  
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;next  
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If we attached a VPC to the transit gateway, and in this example I attached a VPC range of 10.0.0.0/16 to the transit gateway. That IP range would show up in the Fortigate, if we look at the routing table via &lt;em&gt;get router info routing-table all&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;FW01 # get router info routing-table all  
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;Codes: K - kernel, C - connected, S - static, R - RIP, B - BGP  
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;O - OSPF, IA - OSPF inter area  
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2  
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;E1 - OSPF external type 1, E2 - OSPF external type 2  
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;i - IS-IS, L1 - IS-IS level-1, L2 - IS-IS level-2, ia - IS-IS inter area  
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;- candidate default  
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;  
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;Routing table for VRF=0  
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;S* 0.0.0.0/0 [5/0] via `198.51.100.`25, ppp1  
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;B 10.0.0.0/16 [20/100] via 169.254.150.141, AWS-0615bcc6f-1, 03:07:57  
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;              [20/100] via 169.254.157.89, AWS-0615bcc6f-2, 03:07:57  
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;C `198.51.100.1`/32 is directly connected, ppp1  
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;C 169.254.150.141/32 is directly connected, AWS-0615bcc6f-1  
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;C 169.254.150.142/32 is directly connected, AWS-0615bcc6f-1  
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;C 169.254.157.89/32 is directly connected, AWS-0615bcc6f-2  
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;C 169.254.157.90/32 is directly connected, AWS-0615bcc6f-2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can see that 10.0.0.0/16 is available to us via the VPN interfaces, we have equal paths as well, traffic will load balance between each tunnel interface. BGP with ECMP is alive and active! ... That&#39;s all I got for this post, like always I hope this information is helpful, got questions? Comment below!&lt;/p&gt;

        
      </description>
    </item>
    
    <item>
      <title>VTIs with ASA</title>
      <link>https://ciscoskills.net/2020/08/08/vtis-with-asa/</link>
      <pubDate>Sat, 08 Aug 2020 15:41:06 +0000</pubDate>
      
      <guid>https://ciscoskills.net/2020/08/08/vtis-with-asa/</guid>
      <description>
        
          &lt;p&gt;I&#39;ve been stuck in more ways then one this year...working from home indefinitely seems to be the status quo right now, and I&#39;m in &amp;quot;tunnel&amp;quot; mode for most part. Most of these projects I&#39;m working on all of common theme.. connect on-premise to more cloud resources! One way to do that is using VTIs. (Virtual Tunnel Interfaces) VTIs which are not new...been around for a bit, Cisco IOS had the feature available like 10+ years ago! We only got introduced into this technology with ASA when version 9.7 (2017) and above arrived....&lt;/p&gt;
&lt;!--adsense--&gt;
&lt;p&gt;In the old days, which wasn&#39;t that long ago.... We were stuck with cryptomaps to interfaces and dealing with &amp;quot;interesting&amp;quot; traffic when working with ASAs...Well time for change no more defining interesting traffic, we route these bits instead! Any traffic we want to go over the tunnel is routed over, we can apply ACLs on the inbound interface just like we do with physical interfaces, so simple...&lt;/p&gt;
&lt;p&gt;Here is the topology I&#39;m working with:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://ciscoskills.net/images/2020/07/vti-asa.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;This is a pretty standard setup, basically we have two sites and want a tunnel between them. We can setup a VTI Tunnel and route via the next hop address. You can also run a routing protocol over this so this can scale out easy.&lt;/p&gt;
&lt;p&gt;In this example I got two Cisco ASAs using version 9.12(2), just like the old days, things have to match in order to get a tunnel up. In this example I&#39;m using IKEv2 this policy has to match on both ends:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;crypto ikev2 policy 1
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt; encryption 3des
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; integrity sha
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt; group 2
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; prf sha
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; lifetime seconds 86400
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:!: Please use a higher encryption than what I have, this is just for demonstration. :) I also found out that NIST will not allow 3DES starting in 2024. &lt;a href=&#34;https://www.comparitech.com/blog/information-security/3des-encryption/#What_is_3DES&#34;&gt;More Information about the 3DES and history&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We got match a group policy this is configured on both ends, (name could be different)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;group-policy P2P-VPN internal
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;group-policy P2P-VPN attributes
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; vpn-idle-timeout 30
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt; vpn-session-timeout none
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; vpn-filter none
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; vpn-tunnel-protocol ikev2 
&lt;span class=&#34;ln&#34;&gt;7&lt;/span&gt; periodic-authentication certificate none
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next we we create the IPSEC part of the tunnel, again these have to match on both ends:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;crypto ipsec ikev2 ipsec-proposal VPN-P2P
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt; protocol esp encryption aes-256
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; protocol esp integrity sha-256
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Phase Two of the tunnel for IPSEC Proposal, match them on both ends ;)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;crypto ipsec profile VPN-P2P-IPSEC
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt; set ikev2 ipsec-proposal VPN-P2P
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; set pfs group2
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt; set security-association lifetime seconds 84600
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On the site one we create a tunnel group to site two. (preshared keys have to match) In this example I&#39;m using local and remote keys, just like you would expect remote key would match the local key on the remote end, and vise versa.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tunnel-group 203.0.113.2 type ipsec-l2l
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;tunnel-group 203.0.113.2 general-attributes
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; default-group-policy P2P-VPN
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;tunnel-group 203.0.113.2 ipsec-attributes
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; ikev2 remote-authentication pre-shared-key *****
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; ikev2 local-authentication pre-shared-key *****
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On site two we do the same thing, flipping the IP addresses.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tunnel-group 198.51.100.2 type ipsec-l2l
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;tunnel-group 198.51.100.2 general-attributes
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; default-group-policy P2P-VPN
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;tunnel-group 198.51.100.2 ipsec-attributes
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; ikev2 remote-authentication pre-shared-key *****
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; ikev2 local-authentication pre-shared-key *****
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Tunnel is created but in order to bring it up and use we need to create VTI interface on the ASA&#39;s. Here is how site one looks for the the tunnel interface. (tunnel source interface is the direction of how to get to the other site, in this case I&#39;m using the internet)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;interface Tunnel80
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt; nameif VPN-P2P
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; ip address 10.15.161.253 255.255.255.252 
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt; tunnel source interface ISP
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; tunnel destination 203.0.113.2
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; tunnel mode ipsec ipv4
&lt;span class=&#34;ln&#34;&gt;7&lt;/span&gt; tunnel protection ipsec profile VPN-P2P-IPSEC
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If we jump over to site two for that tunnel interface configuration (tunnel interfaces don&#39;t have to match in this case)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;interface Tunnel80
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt; nameif VPN-P2P
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; ip address 10.15.161.254 255.255.255.254 
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt; tunnel source interface ISP
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; tunnel destination 198.51.100.2
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; tunnel mode ipsec ipv4
&lt;span class=&#34;ln&#34;&gt;7&lt;/span&gt; tunnel protection ipsec profile VPN-P2P-CPHX-IPSEC
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can see that we created a little point to point network within the tunnel and if we wanted traffic over this tunnel a simple route statement is all we need :)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;route VPN-P2P 172.22.1.0 255.255.255.0 10.15.161.254 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A simple show command verifies that the tunnel is up (show crypto isakmp)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;There are no IKEv1 SAs
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;IKEv2 SAs:
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;Session-id:1, Status:UP-ACTIVE, IKE count:1, CHILD count:1
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;Tunnel-id Local                                               Remote                                                  Status         Role
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;  3991227 198.51.100.2/500                                    203.0.113.2/500                                          READY    INITIATOR
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;      Encr: 3DES, Hash: SHA96, DH Grp:2, Auth sign: PSK, Auth verify: PSK
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;      Life/Active Time: 86400/3180 sec
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;Child sa: local selector  0.0.0.0/0 - 255.255.255.255/65535
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;          remote selector 0.0.0.0/0 - 255.255.255.255/65535
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;          ESP spi in/out: 0x8e25a2bf/0x90b25811 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Just like that you got yourself a flexible tunnel interface that you can send routes down it, don&#39;t need to deal with crypto maps anymore put those next to the history of 3DES ;) These VTIs make it a breeze to configure.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ciscoskills.net/2020/05/21/the-world-keeps-turning/&#34;&gt;The World Keeps Turning&lt;/a&gt; and we&#39;ll continue to navigate the times as technology plays such a critical piece in making sure communication between people and or systems goes uninterrupted. We as engineers are right in the middle of it... like always I hope this information is helpful, stay calm and carry on!&lt;/p&gt;

        
      </description>
    </item>
    
    <item>
      <title>ASA Site to Site VPN (DHCP)</title>
      <link>https://ciscoskills.net/2017/04/19/asa-site-to-site-vpn-dhcp/</link>
      <pubDate>Wed, 19 Apr 2017 12:00:46 +0000</pubDate>
      
      <guid>https://ciscoskills.net/2017/04/19/asa-site-to-site-vpn-dhcp/</guid>
      <description>
        
          &lt;p&gt;If you don’t already know, site to site VPNs can be a cost-effective way for remote sites to connect to HQ resources instead of a lease line like using MPLS or Metro-E circuits. We can instead use a standard internet connection with a static IP, this is usually cheaper than a dedicated circuit. Our next steps are purchasing a firewall for the remote site (assuming you already have one at HQ) and setup a site to site VPN connection to make the connection. In this guide, I’ll demo a site to site VPN with a pair of ASAs as well as some additional commands to allow DHCP across the tunnel so that your HQ DHCP server can hand out addresses instead of configuring a local DHCP server at the remote site.&lt;/p&gt;
&lt;p&gt;The table below goes over the agreed settings and what networks are protected. Also note that the “public” IP addresses listed in this example are from RFC 5737 and are not publicly available. Since this is a VPN connection we must agree on some common settings before traffic is allowed across it. We will be tunneling the entire address range for both sites and no need to NAT anything because its Acme’s network. Reference the table below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Acme Corp&lt;/th&gt;
&lt;th&gt;Acme Branch&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Peer IP Address: 192.0.2.10&lt;/td&gt;
&lt;td&gt;Peer IP Address: 203.0.113.10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Phase 1: AES 256 SHA (Group 2)&lt;/td&gt;
&lt;td&gt;Phase 1: AES 256 SHA (Group 2)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Phase 2: AES 128 SHA&lt;/td&gt;
&lt;td&gt;Phase 2: AES 128 SHA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PFS: No&lt;/td&gt;
&lt;td&gt;PFS: No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Protected Networks: 10.1.1.0/24&lt;/td&gt;
&lt;td&gt;Protected Networks: 10.1.2.0/24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Preshared Key: cisco&lt;/td&gt;
&lt;td&gt;Preshared Key: cisco&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Here is the topology below for reference:
&lt;img src=&#34;https://ciscoskills.net/images/2017/04/site-site-vpn-dhcp.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Let&#39;s start building the tunnel on the Acme Corp side first by creating object groups:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;object network VPN-REMOTE-ACME-BRANCH-NET-1
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt; subnet 10.1.2.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;object network VPN-REMOTE-ACME-BRANCH-NET-2
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt; subnet 10.1.3.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;object network ACME-CORP-NET
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt; subnet 10.1.1.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;object network VPN-REMOTE-ACORP-BRANCH-NET-1
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt; subnet 10.1.2.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;object network VPN-REMOTE-ACORP-BRANCH-NET-2
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt; subnet 10.1.3.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;object-group network VPN-LOCAL-ACMECORP-NET
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt; network-object object ACME-CORP-NET
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;object-group network VPN-LOCAL-ACORP
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt; network-object object ACME-CORP-NET
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;object-group network VPN-REMOTE-ACORP-BRANCH
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt; network-object object VPN-REMOTE-ACORP-BRANCH-NET-1
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt; network-object object VPN-REMOTE-ACORP-BRANCH-NET-2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next we need to create an access control list to match the traffic we want protected over the tunnel.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;access-list ACL-VPN-ACORP-ACORP-BRANCH extended permit ip object-group VPN-LOCAL-ACORP object-group VPN-REMOTE-ACORP-BRANCH
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have to create some NAT exemption rules as we don&#39;t want to NAT these networks when we are crossing over the VPN. On line one (1) I’m creating a single static NAT entry to reference Acme&#39;s Branch networks going to Acme&#39;s local networks.In line two (2) just reversing so that Acme&#39;s local network can reach Acme&#39;s Branch.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Notice:&lt;/strong&gt; I&#39;m not changing the source or destination address for these NAT rules.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;nat (Outside,Inside) source static VPN-REMOTE-ACORP-BRANCH VPN-REMOTE-ACORP-BRANCH destination static VPN-LOCAL-ACORP VPN-LOCAL-ACORP no-proxy-arp
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;nat (Inside,Outside) source static VPN-LOCAL-ACMECORP-NET VPN-LOCAL-ACMECORP-NET destination static VPN-REMOTE-ACORP-BRANCH VPN-REMOTE-ACORP-BRANCH no-proxy-arp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create a VPN Group Policy for Acme and Acme&#39;s Branch VPN connection&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;group-policy GP-VPN-ACORP-ACORP-BRANCH internal
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;group-policy GP-VPN-ACORP-ACORP-BRANCH attributes
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; vpn-tunnel-protocol ikev1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the tunnel&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tunnel-group 203.0.113.10 type ipsec-l2l
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;tunnel-group 203.0.113.10 general-attributes
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; default-group-policy GP-VPN-ACORP-ACORP-BRANCH
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;tunnel-group 203.0.113.10 ipsec-attributes
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; ikev1 pre-shared-key cisco
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; isakmp keepalive disable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Build the cryptomap:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;crypto map CM-ACORP-ACORP-BRANCH 1 match address ACL-VPN-ACORP-ACORP-BRANCH
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;crypto map CM-ACORP-ACORP-BRANCH 1 set peer 203.0.113.10
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;crypto map CM-ACORP-ACORP-BRANCH 1 set ikev1 transform-set ESP-AES-128-SHA
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;crypto map CM-ACORP-ACORP-BRANCH interface Outside
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&#39;s jump to Acme&#39;s Branch ASA and configure it to get this tunnel up. Let&#39;s create some object-groups.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;object network ACME-BRANCH-NET-1
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt; subnet 10.1.2.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;object network ACME-BRANCH-NET-2
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt; subnet 10.1.3.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;object network VPN-REMOTE-ACME
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt; subnet 10.1.1.0 255.255.255.0
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;object-group network VPN-LOCAL-ACME-BRANCH
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt; network-object object ACME-BRANCH-NET-1
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt; network-object object ACME-BRANCH-NET-2
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;object-group network VPN-REMOTE-ACORP
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt; network-object object VPN-REMOTE-ACME
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the access control list to match the traffic we want protected on Acme&#39;s branch.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;access-list ACL-VPN-ACORP-BRANCH-ACORP extended permit ip object-group VPN-LOCAL-ACME-BRANCH object-group VPN-REMOTE-ACORP
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Just like before we have to create some NAT exemption rules, Acme&#39;s Branch has two networks that need to go over the tunnel so we&#39;ll add them here. Line one (1) and two (2) is one network of Acme&#39;s Branch. Line three (3) and four (4) is another network that Acme&#39;s Branch has and with these two networks we are allowing both an inbound and outbound connection from the VPN.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;nat (Inside,Outside) source static ACME-BRANCH-NET-1 ACME-BRANCH-NET-1 destination static VPN-REMOTE-ACORP VPN-REMOTE-ACORP no-proxy-arp
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;nat (Outside,Inside) source static VPN-REMOTE-ACORP VPN-REMOTE-ACORP destination static ACME-BRANCH-NET-1 ACME-BRANCH-NET-1 no-proxy-arp
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;nat (Outside,Inside-2) source static VPN-REMOTE-ACORP VPN-REMOTE-ACORP destination static ACME-BRANCH-NET-2 ACME-BRANCH-NET-2 no-proxy-arp
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;nat (Inside-2,Outside) source static ACME-BRANCH-NET-2 ACME-BRANCH-NET-2 destination static VPN-REMOTE-ACORP VPN-REMOTE-ACORP no-proxy-arp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create a VPN Group Policy for Acme&#39;s Branch and Acme Corp VPN connection:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;group-policy GP-VPN-ACORP-BRANCH-ACORP internal
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;group-policy GP-VPN-ACORP-BRANCH-ACORP attributes
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; vpn-tunnel-protocol ikev1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the tunnel:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tunnel-group 192.0.2.10 type ipsec-l2l
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;tunnel-group 192.0.2.10 general-attributes
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt; default-group-policy GP-VPN-ACORP-BRANCH-ACORP
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;tunnel-group 192.0.2.10 ipsec-attributes
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt; ikev1 pre-shared-key cisco
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt; isakmp keepalive disable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Build the cryptomap:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;crypto map CM-ACORP-BRANCH-ACORP 1 match address ACL-VPN-ACORP-BRANCH-ACORP
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;crypto map CM-ACORP-BRANCH-ACORP 1 set peer 192.0.2.10
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;crypto map CM-ACORP-BRANCH-ACORP 1 set ikev1 transform-set ESP-AES-128-SHA
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;crypto map CM-ACORP-BRANCH-ACORP interface Outside
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We now have configured everything for the tunnel to come up but we are missing DHCP, in this example since I don&#39;t have Windows DHCP server available I have configured an IOS router to do DHCP, which is on the Acme Corp network (10.1.1.20). To make DHCP available over the tunnel we only have to focus on Acme&#39;s Branch ASA and add in the following configuration:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;dhcprelay server 10.1.1.20 Outside
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;dhcprelay enable Inside
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;dhcprelay enable Inside-2
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;dhcprelay timeout 60
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We should be able to get an IP adderess from Acme&#39;s DHCP server, if I jump over to one of the Windows hosts on the Acme Branch and issue &lt;em&gt;ipconfig /all&lt;/em&gt; we can see that this windows host was able to reach the DHCP server 10.1.1.20 which is over the VPN:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;C:\Documents and Settings\VIRL&amp;gt;ipconfig /all
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;Windows IP Configuration
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;        Host Name . . . . . . . . . . . . : VIRL-D3D4EE00AA
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;        Primary Dns Suffix  . . . . . . . :
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;        Node Type . . . . . . . . . . . . : Unknown
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;        IP Routing Enabled. . . . . . . . : No
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;        WINS Proxy Enabled. . . . . . . . : No
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;Ethernet adapter Local Area Connection:
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;        Connection-specific DNS Suffix  . :
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;        Description . . . . . . . . . . . : Red Hat VirtIO Ethernet Adapter
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;        Physical Address. . . . . . . . . : FA-16-3E-59-67-A3
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;        Dhcp Enabled. . . . . . . . . . . : Yes
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;        Autoconfiguration Enabled . . . . : Yes
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;        IP Address. . . . . . . . . . . . : 10.1.2.61
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;        Subnet Mask . . . . . . . . . . . : 255.255.255.0
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;        Default Gateway . . . . . . . . . : 10.1.2.1
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;        DHCP Server . . . . . . . . . . . : 10.1.1.20
&lt;span class=&#34;ln&#34;&gt;21&lt;/span&gt;        Lease Obtained. . . . . . . . . . : Sunday, April 09, 2017 5:29:25 PM
&lt;span class=&#34;ln&#34;&gt;22&lt;/span&gt;        Lease Expires . . . . . . . . . . : Monday, April 10, 2017 5:29:25 PM
&lt;span class=&#34;ln&#34;&gt;23&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt;24&lt;/span&gt;C:\Documents and Settings\VIRL&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you want to try this out I have attached the running-configs of both firewalls at the end of this post. If you are using Cisco VIRL here is a &lt;a href=&#34;https://github.com/lewiryan/VIRL/blob/master/Completed/ASA-Site-To-Site-DHCP.virl&#34;&gt;link on GitHub&lt;/a&gt; to the file I was working with.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; When working with this file I noticed sometimes that the network switches on both sides don&#39;t always hold a MAC address table when we first start them. The workaround I found is you just copy the configuration delete the switch and add it back and plug everything back in order.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There is a subtype that is added in this configuration which was the Windows XP image I was working with. You can find more information about import Windows VMs and other 3rd Party systems into VIRL by checking out a previous post: &lt;a href=&#34;http://ciscoskills.net/2017/01/07/cisco-virl-and-windows-vms/&#34;&gt;Cisco VIRL and Windows VMs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ciscoskills.net/files/2017/04/running-config-firewalls.docx&#34; title=&#34;Running-Config-Firewalls&#34;&gt;Running-Config-Firewalls&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;As always I hope this is helpful! :)&lt;/p&gt;

        
      </description>
    </item>
    
    <item>
      <title>ASA Site to Site VPN (PATed)</title>
      <link>https://ciscoskills.net/2017/03/08/asa-site-to-site-vpn-pated/</link>
      <pubDate>Wed, 08 Mar 2017 14:30:00 +0000</pubDate>
      
      <guid>https://ciscoskills.net/2017/03/08/asa-site-to-site-vpn-pated/</guid>
      <description>
        
          &lt;p&gt;If you ever needed to hide multiple systems behind a single IP address you would use PAT. (Port Address Translation) besides using this to connect to the internet when using an RFC 1918 address, you can configure PAT for VPN connections. The benefit is the same, hide multiple systems behind a single IP address with the advantage being you can have many systems on one side of the VPN tunnel all using that single IP.&lt;/p&gt;
&lt;p&gt;In this example, we have a site to site VPN connection one side using a PATed public IP address. We originally have two systems that will be sending data over to Contoso  who is the remote peer in this example. We are planning on adding additional systems in the future which is why Acme Corp is using a PATed address outbound. Contoso is expected to send data back to Acme Corp which will also be reflected in this example. Also note that the &amp;quot;public&amp;quot; IP addresses listed in this example are from RFC 5737 and are not publicly available. We have a need to setup a VPN to a partner and have agreed using a public IP address over the VPN connection. We are going to have multiple systems on the local side sending information over to this partner and because of that we&#39;re going to be using a single public PATed address instead of assigning multiple static NATed IPs to each system. The table below goes over the agreed settings and what networks are protected.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Acme Corp&lt;/th&gt;
&lt;th&gt;Contoso Ltd.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Peer IP Address: 192.0.2.10&lt;/td&gt;
&lt;td&gt;Peer IP Address: 203.0.113.10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Phase 1: AES 256 SHA (Group 2)&lt;/td&gt;
&lt;td&gt;Phase 1: AES 256 SHA (Group 2)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Phase 2: AES 128 SHA&lt;/td&gt;
&lt;td&gt;Phase 2: AES 128 SHA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PFS: No&lt;/td&gt;
&lt;td&gt;PFS: No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Protected Networks: 192.0.2.100/32 - &lt;sub&gt;&lt;sup&gt;PATed IP Address. 192.0.2.50/32 - IP Address Contoso will use when sending data to Acme.&lt;/sub&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td&gt;Protected Networks: 203.0.113.30/32 - &lt;sub&gt;&lt;sup&gt;IP Address Acme will use when sending data to Contoso 203.0.113.50/32 - Contoso&#39;s source address when sending data back to Acme.&lt;/sub&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Preshared Key: cisco&lt;/td&gt;
&lt;td&gt;Preshared Key: cisco&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Here is the topology for reference: &lt;img src=&#34;https://ciscoskills.net/images/2017/03/site-site-vpn-example.png&#34; alt=&#34;Site To Site VPN Example&#34;&gt;&lt;/p&gt;
&lt;p&gt;Let&#39;s start building the tunnel for Acme by creating some object groups:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;object network ACCORP-DMZ-SERVER-1
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt; host 10.254.254.10
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;object network Public-IP-192.0.2.100
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt; host 192.0.2.100
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;object network VPN-CONTOSO-CLIENT-1
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt; host 203.0.113.30
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;object network ACCORP-DMZ-SERVER-2
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt; host 10.254.254.20
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;object network ACCORP-DMZ-LB-1
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt; host 10.254.254.30
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;object network Public-IP-192.0.2.50
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt; host 192.0.2.50
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;object network VPN-CONTOSO-CLIENT-2
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt; host 203.0.113.50
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;object-group network ACCORP-DMZ-SERVERS
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt; network-object object ACCORP-DMZ-SERVER-2
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt; network-object object ACCORP-DMZ-SERVER-1
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;object-group network VPN-REMOTE-ACCORP-CONTOSO
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt; network-object object VPN-CONTOSO-CLIENT-1
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt; network-object object VPN-CONTOSO-CLIENT-2
&lt;span class=&#34;ln&#34;&gt;21&lt;/span&gt;object-group network VPN-LOCAL-ACCORP-CONTOSO
&lt;span class=&#34;ln&#34;&gt;22&lt;/span&gt; network-object object Public-IP-192.0.2.100
&lt;span class=&#34;ln&#34;&gt;23&lt;/span&gt; network-object object Public-IP-192.0.2.50
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create an access control list to match the traffic we want protected, these IP addresses would be the NAT address, so we referencing the object-groups.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;access-list ACL-VPN-ACCORP-CONTOSO extended permit ip object-group VPN-LOCAL-ACCORP-CONTOSO
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have to create some NAT rules for Acme. On line one I&#39;m creating a single PAT entry to hide the multiple DMZ servers under one IP address when traffic is going to Contoso. Line two is static entry for traffic inbound from Contoso.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;nat (DMZ,Outside) source dynamic ACCORP-DMZ-SERVERS Public-IP-192.0.2.100 destination static VPN-CONTOSO-CLIENT-1 VPN-CONTOSO-CLIENT-1
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;nat (Outside,DMZ) source static VPN-CONTOSO-CLIENT-2 VPN-CONTOSO-CLIENT-2 destination static Public-IP-192.0.2.50 ACCORP-DMZ-LB-1 no-proxy-arp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create a VPN Group Policy for Acme and Contoso VPN connection:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;group-policy GP-VPN-ACCORP-CONTOSO internal group-policy GP-VPN-ACCORP-CONTOSO attributes vpn-tunnel-protocol ikev1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the tunnel group:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tunnel-group 203.0.113.10 type ipsec-l2l tunnel-group 203.0.113.10 general-attributes default-group-policy GP-VPN-ACCORP-CONTOSO
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;tunnel-group 203.0.113.10 ipsec-attributes ikev1 pre-shared-key cisco isakmp keepalive disable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Build the cryptomap:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;crypto map CM-ACCORP-CONTOSO 1 match address ACL-VPN-ACCORP-CONTOSO
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;crypto map CM-ACCORP-CONTOSO 1 set peer 203.0.113.10
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;crypto map CM-ACCORP-CONTOSO 1 set ikev1 transform-set ESP-AES-128-SHA
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;crypto map CM-ACCORP-CONTOSO 1 set nat-t-disable
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;crypto map CM-ACCORP-CONTOSO interface Outside
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&#39;s all you need from the Acme side to turn up this tunnel, let&#39;s jump to Contoso&#39;s side and configure the tunnel on that side. Jumping on to the Contoso ASA, create some object groups.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;object network CONTOSO-DMZ-SERVER-1
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt; host 172.31.255.10
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;object network PUBLIC-203.0.113.30
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt; host 203.0.113.30
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;object network VPN-ACME-CLIENT-1
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt; host 192.0.2.100
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;object network VPN-ACME-CLIENT-2
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt; host 192.0.2.50
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;object network PUBLIC-203.0.113.50
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt; host 203.0.113.50
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;object-group network VPN-LOCAL-CONTOSO-ACME
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt; network-object object PUBLIC-203.0.113.30
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt; network-object object PUBLIC-203.0.113.50
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;object-group network VPN-REMOTE-CONTOSO-ACME
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt; network-object object VPN-ACME-CLIENT-1
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt; network-object object VPN-ACME-CLIENT-2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Just like on the other side we have to create an access control list to match the traffic we want protected for Contoso.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;access-list ACL-VPN-CONTOSO-ACME extended permit ip object-group VPN-LOCAL-CONTOSO-ACME object-group VPN-REMOTE-CONTOSO-ACME
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create some NAT rules, these are going to static NATs on this side.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;nat (Outside,DMZ) source static VPN-ACME-CLIENT-1 VPN-ACME-CLIENT-1 destination static PUBLIC-203.0.113.30 CONTOSO-DMZ-SERVER-1 no-proxy-arp
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;nat (DMZ,Outside) source static CONTOSO-DMZ-SERVER-1 PUBLIC-203.0.113.50 destination static VPN-ACME-CLIENT-2 VPN-ACME-CLIENT-2 no-proxy-arp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create a VPN group policy for Contoso:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;group-policy GP-VPN-ACME-CONTOSO internal group-policy GP-VPN-ACME-CONTOSO attributes vpn-tunnel-protocol ikev1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the tunnel group for Contoso:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;tunnel-group 192.0.2.10 type ipsec-l2l tunnel-group 192.0.2.10 general-attributes default-group-policy GP-VPN-ACME-CONTOSO
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;tunnel-group 192.0.2.10 ipsec-attributes ikev1 pre-shared-key cisco isakmp keepalive disable\
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Finally build the crypto map:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;crypto map CM-CONTOSO-ACME 1 match address ACL-VPN-CONTOSO-ACME
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;crypto map CM-CONTOSO-ACME 1 set peer 192.0.2.10
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;crypto map CM-CONTOSO-ACME 1 set ikev1 transform-set ESP-AES-128-SHA
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;crypto map CM-CONTOSO-ACME 1 set nat-t-disable
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;crypto map CM-CONTOSO-ACME interface Outside
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can do a some verification tests, If I jump on 10.254.254.20 which is one of the servers in Acme Corp. I&#39;ll try to do a ping test over to Contoso and see if I get any replies back.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;cisco@ACCORP-DMZ-Server-2:~$ ping 203.0.113.30
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;PING 203.0.113.30 (203.0.113.30) 56(84) bytes of data.
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=2 ttl=64 time=3.08 ms
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=3 ttl=64 time=1.52 ms
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=4 ttl=64 time=2.39 ms
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=5 ttl=64 time=1.94 ms
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=6 ttl=64 time=2.08 ms
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=7 ttl=64 time=3.38 ms
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=8 ttl=64 time=2.78 ms
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=9 ttl=64 time=3.16 ms
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;64 bytes from 203.0.113.30: icmp_seq=10 ttl=64 time=1.81 ms
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;^C
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;--- 203.0.113.30 ping statistics ---
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;10 packets transmitted, 9 received, 10% packet loss, time 9018ms
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;rtt min/avg/max/mdev = 1.525/2.465/3.389/0.627 ms
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;cisco@ACCORP-DMZ-Server-2:~$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Looking at the output, I lost one ping packet but that&#39;s likely because the tunnel was not up yet when that first ping packet transmitted over. I&#39;ll jump on the Contoso system and see if I can hit the Acme load server.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;cisco@CONTOSO-DMZ-Server-1:~$ ping 192.0.2.50
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;PING 192.0.2.50 (192.0.2.50) 56(84) bytes of data.
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=2 ttl=64 time=1.82 ms
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=3 ttl=64 time=1.82 ms
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=4 ttl=64 time=1.84 ms
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=5 ttl=64 time=1.69 ms
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=6 ttl=64 time=1.72 ms
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=7 ttl=64 time=1.74 ms
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=8 ttl=64 time=2.16 ms
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=9 ttl=64 time=3.86 ms
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=10 ttl=64 time=1.70 ms
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;64 bytes from 192.0.2.50: icmp_seq=11 ttl=64 time=2.82 ms
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;^C
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;--- 192.0.2.50 ping statistics ---
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;11 packets transmitted, 10 received, 9% packet loss, time 10025ms
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;rtt min/avg/max/mdev = 1.697/2.121/3.863/0.667 ms
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;cisco@R-DMZ-Server-2:~$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It looks like I can hit the Acme load server! We can also finally check both firewalls to verify a VPN is indeed established. On Acme Firewall:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;ASA-1# show crypto isakmp sa
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;IKEv1 SAs:
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;   Active SA: 1
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;    Rekey SA: 0 (A tunnel will report 1 Active and 1 Rekey SA during rekey)
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;Total IKE SA: 1
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;1   IKE Peer: 203.0.113.10
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;    Type    : L2L             Role    : initiator
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;    Rekey   : no              State   : MM_ACTIVE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On Contoso Firewall:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;ASA-2# show crypto isakmp sa
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;IKEv1 SAs:
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;   Active SA: 1
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;    Rekey SA: 0 (A tunnel will report 1 Active and 1 Rekey SA during rekey)
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;Total IKE SA: 1
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt; 
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;1   IKE Peer: 192.0.2.10
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;    Type    : L2L             Role    : responder
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;    Rekey   : no              State   : MM_ACTIVE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&#39;s all I got, I hope this information is helpful. If you want to try this out I have attached the running-configs of both firewalls. If you are using Cisco VIRL here is a &lt;a href=&#34;https://github.com/lewiryan/VIRL/blob/master/Completed/ASA-Site-To-Site.virl&#34;&gt;link on GitHub&lt;/a&gt; to the file I was working with, enjoy! &lt;a href=&#34;https://ciscoskills.net/files/2017/03/running-config-firewalls.pdf&#34;&gt;Running-Config-Firewalls&lt;/a&gt;&lt;/p&gt;

        
      </description>
    </item>
    
    <item>
      <title>Site-To-Site VPN via CCP</title>
      <link>https://ciscoskills.net/2013/05/02/site-to-site-vpn-via-ccp/</link>
      <pubDate>Thu, 02 May 2013 02:45:29 +0000</pubDate>
      
      <guid>https://ciscoskills.net/2013/05/02/site-to-site-vpn-via-ccp/</guid>
      <description>
        
          &lt;p&gt;&lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/security-100026749-gallery.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/security-100026749-gallery.png&#34; alt=&#34;security-gallery-01258&#34;&gt;&lt;/a&gt;I have ran through before on how to create a site-to-site &lt;a href=&#34;http://en.wikipedia.org/wiki/Virtual_private_network&#34; title=&#34;Virtual private network&#34;&gt;VPN&lt;/a&gt; with &lt;a href=&#34;http://en.wikipedia.org/wiki/Cisco_Systems&#34; title=&#34;Cisco Systems&#34;&gt;Cisco&lt;/a&gt; SDM which sounds like a repeat but I thought why not bring CCP into light and since I&#39;m studying the newly created &lt;a href=&#34;http://en.wikipedia.org/wiki/Cisco_Career_Certifications&#34; title=&#34;Cisco Career Certifications&#34;&gt;CCNA Security&lt;/a&gt; (640-554) I figured let&#39;s create a tutorial on it. In this lab I am going to post the running-config of both locations so you can either run it through &lt;a href=&#34;http://en.wikipedia.org/wiki/Packet_Tracer&#34; title=&#34;Packet Tracer&#34;&gt;Packet Tracer&lt;/a&gt; or live equipment if you wish. I am running two Cisco 2811s with Advanced Security Version 12.4(24)T8. Let&#39;s do it! Take a look at my setup, I am running in the RFC 1918 range on a closed track and &amp;quot;technically&amp;quot; have a third &lt;a href=&#34;http://en.wikipedia.org/wiki/Router_%28computing%29&#34; title=&#34;Router (computing)&#34;&gt;router&lt;/a&gt; in the middle just to route between the two &lt;a href=&#34;http://en.wikipedia.org/wiki/Serial_communication&#34; title=&#34;Serial communication&#34;&gt;serial interfaces&lt;/a&gt; to &amp;quot;simulate&amp;quot; the internet. Branch-1 does not know about the &lt;a href=&#34;http://en.wikipedia.org/wiki/Local_area_network&#34; title=&#34;Local area network&#34;&gt;LAN&lt;/a&gt; on Branch-2, and Branch-2 does not know about the LAN on Branch-1. Our task is to configure a Site-To-Site VPN between the two remote Branch offices to be able reach the remote LANs. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/site-to-site-top.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/site-to-site-top.png?w=584&#34; alt=&#34;Branch-1-and-Branch-2&#34;&gt;&lt;/a&gt; Before we jump right into it here is the running-config of both Branch routers before a VPN is setup so you can walk through this yourself. [code]#################################################################### ## START OF RUNNING-CONFIG FOR BRANCH-1 AND BRANCH-2 ## #################################################################### ## START OF CONFIGURATION OF BRANCH-1 ## ! version 12.4 service timestamps debug datetime msec service timestamps log datetime msec no service password-encryption ! hostname BRANCH-1 ! boot-start-marker boot-end-marker ! logging message-counter syslog ! no aaa new-model ! dot11 syslog ip source-route ! ! ip cef ip dhcp excluded-address 192.168.40.0 192.168.40.5 ! ip dhcp pool DHCP-40-POOL network 192.168.40.0 255.255.255.0 dns-server 208.67.222.222 default-router 192.168.40.1 domain-name BRANCH1.CISCOSKILLS.NET ! ! ! multilink bundle-name authenticated ! ! ! username admin privilege 15 secret 5 (MD5 Hashed Password) archive log config hidekeys ! ! ! ! interface FastEthernet0/0 description LOCAL-LAN ip address 192.168.40.1 255.255.255.0 ip nat inside ip virtual-reassembly duplex auto speed auto ! ! ! interface Serial0/0/1 description CONNECTS-TO-INTERNET ip address 192.168.20.10 255.255.255.252 ip nat outside ip virtual-reassembly ! ip forward-protocol nd ip route 0.0.0.0 0.0.0.0 Serial0/0/1 ip http server ip http authentication local no ip http secure-server ! ! ip nat inside source list 5 interface Serial0/0/1 overload ! access-list 5 permit 192.168.40.0 0.0.0.255 ! ! ! control-plane ! ! line con 0 logging synchronous line aux 0 line vty 0 4 login local ! scheduler allocate 20000 1000 end #################################################################### ## END OF CONFIGURATION FOR BRANCH-1 ## #################################################################### ## START OF CONFIGURATION OF BRANCH-2 ## ! version 12.4 service timestamps debug datetime msec service timestamps log datetime msec no service password-encryption ! hostname BRANCH-2 ! boot-start-marker boot-end-marker ! logging message-counter syslog ! no aaa new-model ! dot11 syslog ip source-route ! ! ip cef no ip dhcp use vrf connected ip dhcp excluded-address 192.168.50.0 192.168.50.5 ! ip dhcp pool DHCP-50-POOL network 192.168.50.0 255.255.255.0 default-router 192.168.50.1 dns-server 208.67.222.222 domain-name BRANCH2.CISCOSKILLS.NET ! ! ! multilink bundle-name authenticated ! ! ! username admin privilege 15 secret 5 (MD5 Hashed Password) archive log config hidekeys ! ! ! ! interface FastEthernet0/0 description LOCAL-LAN ip address 192.168.50.1 255.255.255.0 ip nat inside ip virtual-reassembly duplex auto speed auto ! ! interface Serial0/0/0 description CONNECTS-TO-INTERNET ip address 192.168.20.2 255.255.255.252 ip nat outside ip virtual-reassembly no fair-queue ! ! ip forward-protocol nd ip route 0.0.0.0 0.0.0.0 Serial0/0/0 ip http server ip http authentication local no ip http secure-server ! ! ip nat inside source list 5 interface Serial0/0/0 overload ! access-list 5 permit 192.168.50.0 0.0.0.255 ! ! ! control-plane ! ! line con 0 logging synchronous line aux 0 line vty 0 4 login local ! scheduler allocate 20000 1000 end #################################################################### ## END OF CONFIGURATION FOR BRANCH-2 ## #################################################################### ## END OF RUNNING-CONFIG FOR BRANCH-1 AND BRANCH-2 ## ####################################################################[/code] So let&#39; fire up CCP and get started configuring this VPN. Check out my &lt;a href=&#34;http://ciscoskills.net/2013/03/10/introduction-into-cisco-configuration-professional/&#34; title=&#34;Introduction into Cisco Configuration Professional&#34;&gt;Introduction into CCP&lt;/a&gt; which talks about what CCP is and goes through the some of the basics on how to discover devices. So for this example I already have CCP opened on a PC that is on Branch-1&#39;s LAN and have already discovered Branch-1. In CCP I want to create a site-to-site VPN so in order for that to happen I&#39;ll click Configure at the top of the program and expand the Security folder and select Site-To-Site VPN. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-1e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-1e.png?w=584&#34; alt=&#34;CCP-1E&#34;&gt;&lt;/a&gt;Once we selected the site-to-site VPN option we are presented with a general overview of what a site-to-site VPN is and  its functions. Our task is to create a site-to-site VPN so let us select the tab &amp;quot;Create a Site-To-Site-VPN&amp;quot; and then follow that by selecting &amp;quot;Launch the selected task&amp;quot; button. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-2e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-2e.png?w=584&#34; alt=&#34;CCP-2E&#34;&gt;&lt;/a&gt;A window popup should appear something like picture below, basically giving you two options. The quick setup would probably work as it would generate a lot of default commands and if you have two Cisco routers at each end it along with running the quick setup on both ends, you would probably get a VPN up and running with very little configuration effort on your part. But for this guide I want to walk through the advanced setup and look at all the gears and knobs of a VPN. Let&#39;s continue select next. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-3e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-3e.png?w=584&#34; alt=&#34;CCP-3E&#34;&gt;&lt;/a&gt;The next couple of options go over the IKE proposals (&lt;a href=&#34;http://en.wikipedia.org/wiki/Internet_Key_Exchange&#34; title=&#34;Internet Key Exchange&#34;&gt;Internet Key Exchange&lt;/a&gt;) which is all about handling the way keys are passed between devices. So we are not even talking about data being passed yet, just ISAKMP. Since we are on Branch-1 we want to select our outside interface which happens to be the (1) serial interface 0/0/1. The next option is selecting who our peer is or where would we like to build a VPN tunnel which in this case its Branch-2 who&#39;s outside address is  (2) 192.168.20.2. The final section is to create a (3) pre-shared Key that must match on both sides. It is best to create long pre-shared key in a production environment but since this is on a closed course I kept it short and simple, select next. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-4e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-4e.png?w=584&#34; alt=&#34;CCP-4E&#34;&gt;&lt;/a&gt;Like mentioned their actually two tunnels being built for this VPN one of them is just the routers to talk amongst themselves to make sure they agree on the keys and secrets and a second one for data traffic to pass through. This IKE default proposal would work if Branch-2 had the same proposal on Branch-2 but let&#39;s create our own. Select Add. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-5e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-5e.png?w=584&#34; alt=&#34;CCP-5E&#34;&gt;&lt;/a&gt;Another window shows and we are now configuring the IKE Policy, I decided to use (1) AES 256 bit encryption with (2) SHA 1 which is 160 bit hash we are using (3) shared secrets with a (4) Diffie Hellman group 2 and finally with a lifetime of 24 hours which is default. Select OK &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-6e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-6e.png?w=584&#34; alt=&#34;CCP-6E&#34;&gt;&lt;/a&gt;Now we can see our other IKE proposal that we created. Select Next. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-7e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-7e.png?w=584&#34; alt=&#34;CCP-7E&#34;&gt;&lt;/a&gt;The next section is for our IPsec Tunnel which is the tunnel that our data goes through select add to create a transform set, I am going to call this set (1) &amp;quot;BRANCH-TRANS-SET&amp;quot; we are going to (2) check the integrity of data also called ESP. For the (3) Integrity Algorithm will be ESP SHA HMAC and the (4) encryption will be ESP AES 256. Select OK. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-8e-ike.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-8e-ike.png?w=584&#34; alt=&#34;CCP-8E-IKE&#34;&gt;&lt;/a&gt;Our Transform Set is created and we could create more if we wanted to. Let&#39;s select next &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-9e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-9e.png?w=584&#34; alt=&#34;CCP-9E&#34;&gt;&lt;/a&gt;This next section is what traffic would we like to protect with our recently IPec tunnel so we type our local LAN because we want to be able access the remote network (Branch-2&#39;s LAN) over our protected tunnel. Select Next. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-10e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-10e.png?w=584&#34; alt=&#34;CCP-10E&#34;&gt;&lt;/a&gt;We have reached the summary screen which gives us an overview of what will about happen if we decide to deliver these commands by clicking Finish. Let&#39;s see what happens. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-11e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-11e.png?w=584&#34; alt=&#34;CCP-11E&#34;&gt;&lt;/a&gt;Since this is treated like an internet connection I have setup a NAT/PAT rule to translate address to my serial interface on Branch-1. Basically CCP detected this rule and wants to change it. So for this example I will let CCP go ahead and make the change by selecting Yes. &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-12e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-12e.png?w=584&#34; alt=&#34;CCP-12E&#34;&gt;&lt;/a&gt;Here is a list commands CCP has generated to make my VPN tunnel a dream come true and is about deliver them. Let&#39;s deliver these commands! &lt;a href=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-13e.png&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2013/04/ccp-13e.png?w=584&#34; alt=&#34;CCP-13E&#34;&gt;&lt;/a&gt;Unfortunately the tunnel is still down because we have to configure the other side which is Branch-2. We want to do the same thing we did on Branch-1 but change our peer to point to 192.168.20.10 (which is Branch-1&#39;s outside address)  Add the same IKE Proposal and Transform-Set as did with Branch-1 onto Branch-2 and finally flip our traffic to protect. For the local network we put Branch-2&#39;s LAN and for the remote we put Branch-1&#39;s LAN. Once both sides are created they won&#39;t come up until that interesting traffic comes along either from Branch-1&#39;s LAN going to Branch-2&#39;s LAN or Branch-2&#39;s LAN going to Branch-1&#39;s LAN. So I have a PC on Branch-2 and to test this tunnel  I am able to ping Branch-1&#39;s FastEthernet Interface (192.168.40.1) from 192.168.50.6 which is my PC. [code]C:\Documents and Settings\Administrator&amp;gt;ipconfig Ethernet adapter Local Area Connection: Connection-specific DNS Suffix . : BRANCH2.CISCOSKILLS.NET IP Address. . . . . . . . . . . . : 192.168.50.6 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : 192.168.50.1 C:\Documents and Settings\Administrator&amp;gt;ping 192.168.40.1 Pinging 192.168.40.1 with 32 bytes of data: Reply from 192.168.40.1: bytes=32 time=7ms TTL=254 Reply from 192.168.40.1: bytes=32 time=9ms TTL=254 Reply from 192.168.40.1: bytes=32 time=5ms TTL=254 Reply from 192.168.40.1: bytes=32 time=5ms TTL=254 Ping statistics for 192.168.40.1: Packets: Sent = 4, Received = 4, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 5ms, Maximum = 9ms, Average = 6ms C:\Documents and Settings\Administrator&amp;gt;[/code] As we can see I am to ping this connection and that also confirms that the VPN tunnel is up! I hope this tutorial is helpful and below you will find the running-config of both Branch-1 and Branch-2 &#39;s configuration of making this VPN work. &lt;strong&gt;Remember for a closed track you &amp;quot;technically&amp;quot; need another router in the middle of the branches but don&#39;t advertise the LANs.&lt;/strong&gt; Go ahead and load it in Packet Tracer and or live equipment and give it shot you might have to reconfigure some settings deepening on your setup and Packet Tracer does not accept all of the commands. Good Luck and comment below if you have questions! I would be happy to answer them :) [code]#################################################################### ## START OF RUNNING-CONFIG FOR BRANCH-1 AND BRANCH-2 ## #################################################################### ## START OF CONFIGURATION OF BRANCH-1 ## ! version 12.4 service timestamps debug datetime msec service timestamps log datetime msec no service password-encryption ! hostname BRANCH-1 ! boot-start-marker boot-end-marker ! logging message-counter syslog ! no aaa new-model ! dot11 syslog ip source-route ! ip cef ip dhcp excluded-address 192.168.40.0 192.168.40.5 ! ip dhcp pool DHCP-40-POOL network 192.168.40.0 255.255.255.0 dns-server 208.67.222.222 default-router 192.168.40.1 domain-name BRANCH1.CISCOSKILLS.NET ! ! ! multilink bundle-name authenticated ! ! username admin privilege 15 secret 5 (MD5 Hashed Password) archive log config hidekeys ! ! crypto isakmp policy 1 encr 3des authentication pre-share group 2 ! crypto isakmp policy 2 encr aes 256 authentication pre-share group 2 crypto isakmp key cisco address 192.168.20.2 ! ! crypto ipsec transform-set BRANCH-TRANS-SET esp-aes 256 esp-sha-hmac ! crypto map SDM_CMAP_1 1 ipsec-isakmp description Tunnel to192.168.20.2 set peer 192.168.20.2 set transform-set BRANCH-TRANS-SET match address 100 ! ! interface FastEthernet0/0 description LOCAL-LAN ip address 192.168.40.1 255.255.255.0 ip nat inside ip virtual-reassembly duplex auto speed auto ! interface FastEthernet0/1 no ip address shutdown duplex auto speed auto ! interface Serial0/0/1 description CONNECTS-TO-INTERNET ip address 192.168.20.10 255.255.255.252 ip nat outside ip virtual-reassembly crypto map SDM_CMAP_1 ! ip forward-protocol nd ip route 0.0.0.0 0.0.0.0 Serial0/0/1 ip http server ip http authentication local no ip http secure-server ! ! ip nat inside source route-map SDM_RMAP_1 interface Serial0/0/1 overload ! access-list 5 remark CCP_ACL Category=16 access-list 5 permit 192.168.40.0 0.0.0.255 access-list 100 remark CCP_ACL Category=4 access-list 100 remark IPSec Rule access-list 100 permit ip 192.168.40.0 0.0.0.255 192.168.50.0 0.0.0.255 access-list 101 remark CCP_ACL Category=2 access-list 101 remark IPSec Rule access-list 101 deny ip 192.168.40.0 0.0.0.255 192.168.50.0 0.0.0.255 access-list 101 permit ip 192.168.40.0 0.0.0.255 any ! ! route-map SDM_RMAP_1 permit 1 match ip address 101 ! ! control-plane ! ! line con 0 logging synchronous line aux 0 line vty 0 4 login local ! scheduler allocate 20000 1000 end #################################################################### ## END OF CONFIGURATION FOR BRANCH-1 ## #################################################################### ## START OF CONFIGURATION OF BRANCH-2 ## ! version 12.4 service timestamps debug datetime msec service timestamps log datetime msec no service password-encryption ! hostname BRANCH-2 ! boot-start-marker boot-end-marker ! logging message-counter syslog no logging buffered ! no aaa new-model ! dot11 syslog ip source-route ! ip cef no ip dhcp use vrf connected ip dhcp excluded-address 192.168.50.0 192.168.50.5 ! ip dhcp pool DHCP-50-POOL network 192.168.50.0 255.255.255.0 default-router 192.168.50.1 dns-server 208.67.222.222 domain-name BRANCH2.CISCOSKILLS.NET ! ! ! multilink bundle-name authenticated ! ! username admin privilege 15 secret 5 (MD5 Hashed Password) archive log config hidekeys ! ! crypto isakmp policy 1 encr 3des authentication pre-share group 2 ! crypto isakmp policy 2 encr aes 256 authentication pre-share group 2 crypto isakmp key cisco address 192.168.20.10 ! ! crypto ipsec transform-set BRANCH-TRANS-SET esp-aes 256 esp-sha-hmac ! crypto map SDM_CMAP_1 1 ipsec-isakmp description Tunnel to192.168.20.10 set peer 192.168.20.10 set transform-set BRANCH-TRANS-SET match address 100 ! ! interface FastEthernet0/0 description LOCAL-LAN ip address 192.168.50.1 255.255.255.0 ip nat inside ip virtual-reassembly duplex auto speed auto ! interface FastEthernet0/1 no ip address shutdown duplex auto speed auto ! interface Serial0/0/0 description CONNECTS-TO-INTERNET ip address 192.168.20.2 255.255.255.252 ip nat outside ip virtual-reassembly no fair-queue crypto map SDM_CMAP_1 ! ! ip forward-protocol nd ip route 0.0.0.0 0.0.0.0 Serial0/0/0 ip http server ip http authentication local no ip http secure-server ! ! ip nat inside source route-map SDM_RMAP_1 interface Serial0/0/0 overload ! access-list 5 remark CCP_ACL Category=16 access-list 5 permit 192.168.50.0 0.0.0.255 access-list 100 remark CCP_ACL Category=4 access-list 100 remark IPSec Rule access-list 100 permit ip 192.168.50.0 0.0.0.255 192.168.40.0 0.0.0.255 access-list 101 remark CCP_ACL Category=2 access-list 101 remark IPSec Rule access-list 101 deny ip 192.168.50.0 0.0.0.255 192.168.40.0 0.0.0.255 access-list 101 permit ip 192.168.50.0 0.0.0.255 any ! ! route-map SDM_RMAP_1 permit 1 match ip address 101 ! ! control-plane ! ! line con 0 logging synchronous line aux 0 line vty 0 4 login local ! scheduler allocate 20000 1000 end #################################################################### ## END OF CONFIGURATION FOR BRANCH-2 ## #################################################################### ## END OF RUNNING-CONFIG FOR BRANCH-1 AND BRANCH-2 ## ####################################################################[/code]&lt;/p&gt;
&lt;h6 id=&#34;related-articles&#34;&gt;Related articles&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://ciscoskills.net/2013/04/03/configuring-aaa-locally/&#34;&gt;Configuring AAA - Locally&lt;/a&gt; (ciscoskills.net)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://ciscoskills.net/2013/03/10/introduction-into-cisco-configuration-professional/&#34;&gt;Introduction into Cisco Configuration Professional&lt;/a&gt; (ciscoskills.net)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;comments&#34;&gt;Comments:&lt;/h3&gt;
&lt;h4 id=&#34;heading&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;http://ubuntuforus.wordpress.com/2013/05/04/certificate-bug-in-open-source-ipsec-vpn/&#34; title=&#34;&#34;&gt;Certificate bug in open source IPsec VPN | Ubuntu For Humans&lt;/a&gt; - &lt;time datetime=&#34;2013-05-04 04:34:08&#34;&gt;May 6, 2013&lt;/time&gt;&lt;/p&gt;
&lt;p&gt;[...] Site-To-Site VPN via CCP (ciscoskills.net) [...]&lt;/p&gt;
&lt;hr /&gt;

        
      </description>
    </item>
    
    <item>
      <title>Configure a Site-to-Site VPN via SDM</title>
      <link>https://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/</link>
      <pubDate>Wed, 27 Apr 2011 18:00:24 +0000</pubDate>
      
      <guid>https://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/</guid>
      <description>
        
          &lt;h2 id=&#34;so-for-todays-post-lets-learn-how-to-configure-a-site-to-site-vpnhttpenwikipediaorgwikivirtual_private_network-virtual-private-network-on-a-router-using-the-ciscohttpenwikipediaorgwikicisco_systems-cisco-systems-sdm-security-device-manger-the-cisco-sdm-is-a-web-basedhttpenwikipediaorgwikiweb_application-web-application-device-management-tool-a-guihttpenwikipediaorgwikigraphical_user_interface-graphical-user-interface-for-cisco-routershttpenwikipediaorgwikirouter-router-this-can-simplify-router-deployments-and-cutownership-costs-see-the-post-configuring-sdm-lets-start-configuring-a-site-to-site-vpn-with-sdm-this-tutorialhttpenwikipediaorgwikitutorial-tutorial-is-assuming-that-the-configurations-to-set-up-cisco-sdm-have-already-been-completed-for-this-tutorial-all-we-want-to-focus-on-is-configuring-the-vpn-since-this-using-cisco-sdm-the-vpn-wizard-is-pretty-simple-to-understand-before-we-get-started-however-i-like-to-have-the-cisco-sdm-preview-the-commands-before-i-deliver-them-to-the-router-to-do-that-at-the-top-of-the-menu-bar-click-_edit_-and-select-_preferences_-a-new-window-will-appear-like-below-and-verify-that-the-_preview-commands-before-delivering-to-the-router_is-checkedsdm-preferenceshttpsystemstechblogfileswordpresscom201104preview_commandsepngw300-preview_commandshttpciscoskillsnet20110420configuring-zone-based-firewalls-via-sdmpreview_commandseonce-cisco-sdm-is-opened-click-on-the-configure-button-at-the-top-of-the-sdm-screen-and-select-the-vpn-button-on-the-left-hand-side-under-tasks-under-the-vpn-folder-select-the-site-to-site-vpn-you-now-have-two-choices-for-this-tutorial-we-are-using-the-first-option-create-a-site-to-site-vpn-once-you-have-selected-your-option-select-the-launch-the-selected-task-to-begin-the-wizardsdm-vpn-pagehttpsystemstechblogfileswordpresscom201104vpn-pageepngw300-vpn-pagehttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn-pageea-new-window-will-open-site-to-site-vpn-wizard-this-welcome-page-will-introduce-you-the-settings-you-can-choose-the-quick-setup-will-ask-for-minimal-information-when-configuring-the-router-you-can-also-view-defaults-the-quick-setup-will-attempt-to-deliver-to-the-router-by-selecting-the-view-defaults-button-there-is-also-a-step-by-step-wizard-which-allows-more-flexible-options-for-this-tutorial-we-are-choosing-the-quick-setup-wizard-click-nextsdm-vpn-wizardhttpsystemstechblogfileswordpresscom201104vpn_wizardepngw300-vpn_wizardhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizardethe-next-part-of-the-wizard-will-show-vpn-connection-information-this-screen-has-the-following-configuration-options-vpn-connection-which-interface-will-have-the-vpn-option-the-peer-identity-the-authentication-types-and-the-traffic-that-needs-to-be-encryptedsdm-vpn-wizard-connectionhttpsystemstechblogfileswordpresscom201104vpn_wizard_connectionpngw300-vpn_wizard_connectionhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_connection-focusing-on-the-vpn-connection-information-which-interface-will-have-the-vpn-for-this-tutorial-we-selected-serial-00vpn_wizard-connection-informationhttpsystemstechblogfileswordpresscom201104vpn_wizard_connection_informationepngw300-vpn_wizard_connection_informationhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_connection_informationeif-you-selected-the-detail-button-you-can-get-additionalinformation-about-the-connectioninterface-you-selected-in-this-tutorial-we-selected-serial-00-and-clicking-on-the-details-gives-us-more-information-about-the-connectionvpn-wizard-detailhttpsystemstechblogfileswordpresscom201104vpn_wizard_detailpngw300-vpn_wizard_detailhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_detaillets-now-focus-on-the-peer-identify-if-you-selected-from-the-drop-down-box-peer-with-static-address-this-address-will-be-the-other-router-ip-addresshttpenwikipediaorgwikiip_address-ip-address-for-this-tutorial-the-ip-address-is-1721611vpn-wizard-peerhttpsystemstechblogfileswordpresscom201104vpn_wizard_peerepngw300-vpn_wizard_peerhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_peerefocusing-on-the-authentication-you-can-have-two-options-when-using-the-quick-setup-wizard-pre-shared-keys-or-digital-certificateshttpenwikipediaorgwikipublic_key_certificate-public-key-certificate-for-this-tutorial-we-are-using-pre-shared-keys-these-keys-must-be-the-same-on-the-other-end-of-the-vpn-tunnel-in-order-for-the-vpn-to-worksdm-vpn-wizard-authhttpsystemstechblogfileswordpresscom201104vpn_wizard_authepngw300-vpn_wizard_authhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_authetowards-the-bottom-of-the-screen-we-have-one-final-configuration-step-the-traffic-to-encrypthttpenwikipediaorgwikiencryption-encryption-the-source-traffic-is-the-traffic-that-will-be-encryptedwhen-it-leaves-the-local-interface-this-traffic-will-only-be-encrypted-when-the-traffic-goes-to-the-destination-ip-address-for-this-tutorial-the-connection-is-fast-ethernethttpenwikipediaorgwikifast_ethernet-fast-ethernet00-and-the-traffic-will-be-encrypted-when-the-destination-ip-address-is-19216831-with-a-2552552550-subnet-mask-click-nextsdm-vpn-wizard-traffic-httpsystemstechblogfileswordpresscom201104vpn_wizard_trafficepngw300-vpn_wizard_traffichttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_trafficethe-next-section-is-the-summary-screen-for-the-site-to-site-vpn-configuration-here-you-can-look-over-the-summary-to-verify-the-configuration-click-finishsdm-vpn-summaryhttpsystemstechblogfileswordpresscom201104vpn_wizard_finishepngw300-vpn_wizard_summaryhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_finisheif-youve-selected-the-option-to-preview-commands-before-delivering-them-to-the-router-a-final-window-will-appear-in-this-window-you-can-see-the-realcommands-the-sdm-program-will-attempt-to-deliver-you-have-the-optionto-save-the-running-configuration-to-the-startup-configuration-after-the-commands-complete-you-also-have-the-option-to-save-the-configuration-as-a-file-and-finally-you-can-deliver-them-to-the-routersdm-vpn-deliverhttpsystemstechblogfileswordpresscom201104vpn_wizard_deliverepngw300-vpn_wizard_deliverhttpciscoskillsnet20110427configure-a-site-to-site-vpn-via-sdmvpn_wizard_deliverethats-it-believe-it-or-not-thats-the-sdm-configuration-for-site-to-site-vpn-configuration-you-can-get-moreinformation-at-ciscos-website-about-sdm-and-the-configuration-settings-like-always-i-hope-this-tutorial-was-informative-and-if-you-have-a-suggestionon-the-next-topic-that-relates-to-icnd1or-icnd2-and-even-some-ccna-security-comment-below&#34;&gt;So for today&#39;s post let&#39;s learn how to configure a site-to-site &lt;a href=&#34;http://en.wikipedia.org/wiki/Virtual_private_network&#34; title=&#34;Virtual private network&#34;&gt;VPN&lt;/a&gt; on a router using the &lt;a href=&#34;http://en.wikipedia.org/wiki/Cisco_Systems&#34; title=&#34;Cisco Systems&#34;&gt;Cisco&lt;/a&gt; SDM (Security Device Manger). The Cisco SDM is a &lt;a href=&#34;http://en.wikipedia.org/wiki/Web_application&#34; title=&#34;Web application&#34;&gt;Web-based&lt;/a&gt; device management tool a &lt;a href=&#34;http://en.wikipedia.org/wiki/Graphical_user_interface&#34; title=&#34;Graphical user interface&#34;&gt;GUI&lt;/a&gt; for Cisco &lt;a href=&#34;http://en.wikipedia.org/wiki/Router&#34; title=&#34;Router&#34;&gt;routers&lt;/a&gt; this can simplify router deployments and cut ownership costs. (See the post Configuring SDM) Let&#39;s start configuring a site-to-site VPN with SDM! This &lt;a href=&#34;http://en.wikipedia.org/wiki/Tutorial&#34; title=&#34;Tutorial&#34;&gt;tutorial&lt;/a&gt; is assuming that the configurations to set up Cisco SDM have already been completed. For this tutorial all we want to focus on is configuring the VPN. Since this using Cisco SDM the VPN wizard is pretty simple to understand. Before we get started however I like to have the Cisco SDM preview the commands before I deliver them to the router. To do that at the top of the menu bar click &lt;em&gt;Edit&lt;/em&gt; and select &lt;em&gt;Preferences&lt;/em&gt; a new window will appear (Like below) and verify that the &lt;em&gt;Preview commands before delivering to the router&lt;/em&gt; is checked.&lt;a href=&#34;http://ciscoskills.net/2011/04/20/configuring-zone-based-firewalls-via-sdm/preview_commandse/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/preview_commandse.png?w=300&#34; alt=&#34;SDM Preferences&#34; title=&#34;Preview_Commands&#34;&gt;&lt;/a&gt;Once Cisco SDM is opened click on the configure button at the top of the SDM screen and select the VPN button on the left hand side under Tasks. Under the VPN folder select the Site-to-Site VPN. You now have two choices, for this tutorial we are using the first option. (Create a Site to Site VPN) Once you have selected your option select the Launch the selected task to begin the wizard.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn-pagee/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn-pagee.png?w=300&#34; alt=&#34;SDM VPN Page&#34; title=&#34;VPN Page&#34;&gt;&lt;/a&gt;A new window will open (Site-to-Site VPN Wizard) this welcome page will introduce you the settings you can choose. The quick setup will ask for minimal information when configuring the router. You can also view defaults the quick setup will attempt to deliver to the router by selecting the View Defaults button. There is also a Step by step wizard which allows more flexible options. (For this tutorial we are choosing the Quick setup wizard) Click Next.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizarde/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizarde.png?w=300&#34; alt=&#34;SDM VPN Wizard&#34; title=&#34;VPN_Wizard&#34;&gt;&lt;/a&gt;The next part of the wizard will show (VPN Connection Information) this screen has the following configuration options, VPN connection (which interface will have the VPN option), the peer identity, the authentication types, and the traffic that needs to be encrypted.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_connection/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_connection.png?w=300&#34; alt=&#34;SDM VPN Wizard Connection&#34; title=&#34;VPN_Wizard_Connection&#34;&gt;&lt;/a&gt; Focusing on the VPN connection information, which interface will have the VPN? For this tutorial we selected serial 0/0.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_connection_informatione/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_connection_informatione.png?w=300&#34; alt=&#34;VPN_Wizard Connection Information&#34; title=&#34;VPN_Wizard_Connection_Information&#34;&gt;&lt;/a&gt;If you selected the detail button, you can get additional information about the connection (interface) you selected. In this tutorial we selected serial 0/0 and clicking on the details gives us more information about the connection.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_detail/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_detail.png?w=300&#34; alt=&#34;VPN Wizard Detail&#34; title=&#34;VPN_Wizard_Detail&#34;&gt;&lt;/a&gt;Let&#39;s now focus on the Peer Identify; if you selected from the drop-down box Peer with static address this address will be the other router &lt;a href=&#34;http://en.wikipedia.org/wiki/IP_address&#34; title=&#34;IP address&#34;&gt;IP address&lt;/a&gt;. For this tutorial the IP address is 172.16.1.1.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_peere/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_peere.png?w=300&#34; alt=&#34;VPN Wizard Peer&#34; title=&#34;VPN_Wizard_Peer&#34;&gt;&lt;/a&gt;Focusing on the Authentication, you can have two options when using the Quick Setup wizard, pre-shared keys or &lt;a href=&#34;http://en.wikipedia.org/wiki/Public_key_certificate&#34; title=&#34;Public key certificate&#34;&gt;Digital Certificates&lt;/a&gt;. (For this tutorial we are using pre-shared keys) These keys must be the same on the other end of the VPN tunnel in order for the VPN to work.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_authe/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_authe.png?w=300&#34; alt=&#34;SDM VPN Wizard Auth&#34; title=&#34;VPN_Wizard_Auth&#34;&gt;&lt;/a&gt;Towards the bottom of the screen we have one final configuration step, the traffic to &lt;a href=&#34;http://en.wikipedia.org/wiki/Encryption&#34; title=&#34;Encryption&#34;&gt;encrypt&lt;/a&gt;. The source traffic is the traffic that will be encrypted when it leaves the local interface, this traffic will only be encrypted when the traffic goes to the destination IP address. (For this tutorial the connection is &lt;a href=&#34;http://en.wikipedia.org/wiki/Fast_Ethernet&#34; title=&#34;Fast Ethernet&#34;&gt;Fast-Ethernet&lt;/a&gt; 0/0 and the traffic will be encrypted when the destination IP address is 192.168.3.1 with a 255.255.255.0 subnet mask.) Click Next.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_traffice/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_traffice.png?w=300&#34; alt=&#34;SDM VPN Wizard Traffic &#34; title=&#34;VPN_Wizard_Traffic&#34;&gt;&lt;/a&gt;The next section is the summary screen for the Site-to-Site VPN configuration, here you can look over the summary to verify the configuration. Click Finish.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_finishe/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_finishe.png?w=300&#34; alt=&#34;SDM VPN Summary&#34; title=&#34;VPN_Wizard_Summary&#34;&gt;&lt;/a&gt;If you&#39;ve selected the option to preview commands before delivering them to the router, a final window will appear. In this window you can see the real commands the SDM program will attempt to deliver. You have the option to save the running-configuration to the startup-configuration after the commands complete. You also have the option to save the configuration as a file and finally you can deliver them to the router.&lt;a href=&#34;http://ciscoskills.net/2011/04/27/configure-a-site-to-site-vpn-via-sdm/vpn_wizard_delivere/&#34;&gt;&lt;img src=&#34;http://systemstechblog.files.wordpress.com/2011/04/vpn_wizard_delivere.png?w=300&#34; alt=&#34;SDM VPN Deliver&#34; title=&#34;VPN_Wizard_Deliver&#34;&gt;&lt;/a&gt;That&#39;s it! Believe it or not that&#39;s the SDM configuration for Site-to-Site VPN configuration you can get more information at Cisco&#39;s website about SDM and the configuration settings. Like always I hope this tutorial was informative and if you have a suggestion on the next topic that relates to ICND1 or ICND2 and even some CCNA Security comment below.&lt;/h2&gt;
&lt;h3 id=&#34;comments&#34;&gt;Comments:&lt;/h3&gt;
&lt;h4 id=&#34;heading&#34;&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;http://ciscoskills.net/2011/05/02/configure-static-routing/&#34; title=&#34;&#34;&gt;Configure Static Routing | Cisco Skills&lt;/a&gt; - &lt;time datetime=&#34;2011-05-02 20:55:07&#34;&gt;May 1, 2011&lt;/time&gt;&lt;/p&gt;
&lt;p&gt;[...] Configure a Site-to-Site VPN via SDM (ciscoskills.net) [...]&lt;/p&gt;
&lt;hr /&gt;

        
      </description>
    </item>
    
  </channel>
</rss>
